# Тестовое задание в DataArmor
Прокси-сервер для логгирования sql запросов к PostreSQL
Делал зимой 2022

# Сборка и запуск Proxy

В папке bin:

1. Подготовить билд систему

    `cmake ..` 

2. Собрать программу

    `cmake --build .`

3. Запустить прокси с параметрами: хост&порт прокси, хост&порт БД

    `./pgproxy 127.0.0.1 3333 127.0.0.1 5432`


# Демонстрация работы

## Описание
Прокси работает с любыми клиентами, а Логгер - только через нижеописанный костыль.

Подключение к БД через прокси можно осуществлять через разные средства, но при тестировании подключений через jdbc(java) и psycopg2(python) сообщения передавались будто в хэшированном виде - кракозябры разной длинны при одних и тех же запросах.
Расшифровать их не получилось, соответственно запросы для логгирования не вычленялись.

Самостоятельно писать драйвер для Клиента бд кажется слишком, но только так оно работало.
Поэтому взял код на nodejs из одного туториала, который реализовывает протокол постгреса в "открытом" виде, где все сообщения читаются и никаких кракозябр.

## Запуск
1. установить nodejs, если нет. Для ubuntu: 

    `sudo apt install nodejs`

2. Дать права на запуск bash скрипта, который запускает 4 Клиентов бд на nodejs

    `chmod u+x demo.sh`

3. Запустить с аргументами для подключения к бд: host, port, username, password, db name, например

    `./demo.sh 127.0.0.1 3333 postgres postgres demo`


4. В файле `log/db_queries.log` лежат результаты работы 4 клиентов. 
При подключении клиента создается демо таблица "names", если ещё не создана.
Каждый клиент отправляет 150 своих запросов: первый- insert'ы, второй - update'ы, третий - select'ы, четвертый - delete'ы. 
# dataarmor-test-task
